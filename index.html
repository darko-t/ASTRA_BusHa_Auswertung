<script type="module">
  import { ensureJupyterLite } from './build/ensure-jupyterlite.js';
  import JSZip from 'https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm';

  async function downloadAllFiles() {
    const { contentsManager } = await ensureJupyterLite();

    const zip = new JSZip();
    const walk = async (path = '') => {
      const listing = await contentsManager.get(path);
      for (const file of listing.content) {
        const fullPath = (path ? path + '/' : '') + file.name;
        if (file.type === 'directory') {
          await walk(fullPath);
        } else {
          const data = await contentsManager.get(fullPath, { content: true, format: 'text' });
          zip.file(fullPath, data.content);
        }
      }
    };

    await walk(); // walk the root directory
    const blob = await zip.generateAsync({ type: 'blob' });

    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'jupyterlite-files.zip';
    a.click();
    URL.revokeObjectURL(a.href);
  }
</script>
